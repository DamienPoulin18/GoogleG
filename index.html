<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Blox Fruits - Home</title>
    <link id="fav" rel="icon" type="image/x-icon" href="https://www.google.com">
    <style>
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: #000; font-family: sans-serif; }
        #bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('RedKing.png') center/cover; z-index: 5; }
        /* La zone de vue est mise en z-index 10 pour être au-dessus */
        #view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: #fff; }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* Overlay invisible pour capter la souris même sur l'iframe */
        #sensor { position: fixed; top: 0; left: 0; width: 100%; height: 10px; z-index: 100; pointer-events: all; }
    </style>
</head>
<body oncontextmenu="return false;">

    <!-- Zone invisible tout en haut qui capte si la souris sort par le haut -->
    <div id="sensor"></div>

    <div id="bg"></div>
    <div id="view"><iframe id="ifr" src="about:blank"></iframe></div>

    <script>
        const _0x = (s) => s.split('').map(c => String.fromCharCode(c.charCodeAt(0) - 1)).join('');
        const P_URL = _0x("iuuqt;00rvbtbs/vc/qivsj/dd"); 
        const C_URL = _0x("iuuqt;00dmbttsppn/hpphmf/dpn0v010i");
        const S_KEY = _0x("lbtqo");

        let input = "";
        let isActive = false;

        // --- CORRECTION AUTO-HIDE ---
        // Détecte quand la souris quitte la fenêtre vers le haut (barre d'onglets)
        // DÉTECTION : SOURIS QUI QUITTE LA FENÊTRE
document.addEventListener('mouseleave', () => {
    // Si le proxy est actif, on déclenche la redirection immédiate
    if (isActive) {
        window.location.replace("https://classroom.google.com");
    }
});

// SÉCURITÉ SUPPLÉMENTAIRE : SI L'ONGLET PERD LE FOCUS
document.addEventListener('visibilitychange', () => {
    if (document.hidden && isActive) {
        window.location.replace("https://classroom.google.com");
    }
});


        // Détecte si on change d'onglet ou si on réduit la fenêtre
        // DÉTECTION DU CHANGEMENT D'ONGLET (VISIBILITY API)
document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
        // L'utilisateur a quitté l'onglet : ON EFFACE TOUT
        fermerInstantement();
    }
});

function fermerInstantement() {
    const v = document.getElementById('view');
    const bg = document.getElementById('bg');
    const f = document.getElementById('ifr');

    // 1. On cache le proxy
    v.style.display = 'none'; 
    
    // 2. On réaffiche l'image Blox Fruits
    bg.style.display = 'block'; 
    
    // 3. ON VIDE L'IFRAME (Indispensable pour que Quasar disparaisse du réseau)
    f.src = 'about:blank'; 
    
    // 4. On remet le titre normal
    document.title = "Blox Fruits - Home";
    
    isActive = false;
    input = ""; // Reset du code secret
}


        // Détecte si la fenêtre perd le focus (Alt+Tab ou clic ailleurs)
        window.addEventListener('blur', () => {
            if (isActive) masquerRapidement();
        });

        function masquerRapidement() {
            document.getElementById('view').style.display = 'none';
            document.getElementById('bg').style.display = 'block';
            document.title = "Blox Fruits - Home";
            // On ne coupe pas le lien pour pouvoir revenir vite avec le code
            isActive = false; 
        }

        document.addEventListener('keydown', (e) => {
            const k = e.key.toLowerCase();

            if (k === 'q') {
                window.location.replace(C_URL);
                return;
            }

            input += k;
            if (input.endsWith(S_KEY)) {
                window.history.pushState({state:1}, "", "/drive/u/0/my-drive");
                launch();
                input = "";
            }
            if (input.length > 10) input = "";
        });

        function launch() {
            const v = document.getElementById('view');
            const f = document.getElementById('ifr');
            if (f.src === "about:blank") f.src = P_URL;
            
            document.getElementById('bg').style.display = 'none';
            v.style.display = 'block';
            document.title = "Google Docs";
            isActive = true;
        }
    </script>
</body>
</html>
